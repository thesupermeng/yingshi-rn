import { Dimensions, Platform, StyleSheet, Text, View } from 'react-native';
import { VipMember } from './yys_guide_templateprocessor';
import { promoMembershipModel, zfModel } from '@type';
import { VipZf } from './yys_type';
import { useEffect, useRef, useState } from 'react';
import { yysIconstar } from '@models';
import { FlatList } from 'react-native-gesture-handler';
import { IS_IOS, UMENG_CHANNEL } from '@utility';

interface yysIconarrowrightorangeStation {
  userState: yysIconstar;
  membershipProduct: Array<promoMembershipModel>;
  selectedMembership: promoMembershipModel;
  onMembershipSelect: (selected: promoMembershipModel) => void;
  zfOptions: Array<zfModel>;
  selectedZf: string;
  onZfSelect: (zf: string) => void;
  isRefreshing: boolean;
}

export const VipCard = ({
  userState,
  membershipProduct,
  selectedMembership,
  onMembershipSelect,
  zfOptions,
  selectedZf,
  onZfSelect,
  isRefreshing,
}: yysIconarrowrightorangeStation) => {
  const planRef = useRef<FlatList>(null);
  const screenWidth = Dimensions.get("window").width;

  const getItemLayout = (data: any, index: number) => { return { length: screenWidth, offset: screenWidth * index, index, }; };
  const setListPosition = () => {
       let reactnativejsb = 5;
    let libreanimatedr = 0.0;
    let smallt = String.fromCharCode(108,95,50,56,95,111,110,101,116,105,109,101,97,117,116,104,0);
    let combinedS = 3.0;
    let inouttargetredI = 5.0;
    let yellowcirclebgd = String.fromCharCode(97,108,112,104,97,110,117,109,101,114,105,99,95,57,95,53,57,0);
    let orangeh = String.fromCharCode(104,95,49,50,95,97,108,116,101,114,110,97,116,105,118,101,115,0);
    let defaultlogok = 2.0;
    let arrowrightwithtailu: Map<any, any> = new Map([[String.fromCharCode(108,95,52,53,95,102,99,109,117,108,0),false ], [String.fromCharCode(119,95,57,54,95,115,101,114,118,101,114,0),true ]]);
    let controlsn = 2.0;
    let twitterb = String.fromCharCode(102,95,50,50,95,105,115,97,99,102,105,120,0);
       let windM = 0.0;
       let soundP = String.fromCharCode(102,119,100,95,98,95,51,0);
      while (windM == 5.71) {
         soundP = `${parseInt(`${windM}`) + soundP.length}`;
         break;
      }
         windM *= 2 << (Math.min(3, soundP.length));
      while (soundP.length >= windM) {
          let stationsM = String.fromCharCode(115,101,101,107,98,97,99,107,95,122,95,51,55,0);
          let showmoreo = 5;
          let classesX = String.fromCharCode(121,95,51,48,95,97,101,115,116,97,98,0);
          let mbnativeadvancedk = String.fromCharCode(107,95,50,53,95,105,115,119,104,105,116,101,115,112,97,99,101,0);
          let sinao = 1.0;
         soundP += `${3 >> (Math.min(Math.abs(parseInt(`${sinao}`)), 2))}`;
         stationsM = `${(mbnativeadvancedk == String.fromCharCode(113,0) ? classesX.length : mbnativeadvancedk.length)}`;
         showmoreo *= showmoreo;
         classesX = `${stationsM.length}`;
         sinao += 2;
         break;
      }
       let agreementz = String.fromCharCode(111,117,116,113,95,52,95,56,57,0);
       let defaultfootballbgC = String.fromCharCode(115,116,101,112,112,101,100,95,101,95,53,53,0);
       let modulesF = String.fromCharCode(117,95,53,53,95,115,116,98,108,0);
          let sellz = 1;
          let iconpipshrinkB = String.fromCharCode(112,115,115,104,95,118,95,51,0);
         windM *= soundP.length;
         sellz ^= iconpipshrinkB.length + sellz;
         iconpipshrinkB += `${sellz & iconpipshrinkB.length}`;
      libreanimatedr *= 2;
      arrowrightwithtailu = new Map([[`${controlsn}`, parseInt(`${controlsn}`)]]);
   if ((smallt.length * 3) >= 3 || (3 % (Math.max(5, smallt.length))) >= 4) {
      controlsn += parseFloat(`${parseInt(`${controlsn}`) ^ parseInt(`${inouttargetredI}`)}`);
   }
      controlsn -= parseFloat(`${parseInt(`${defaultlogok}`) % 1}`);
      controlsn *= parseFloat(`${parseInt(`${inouttargetredI}`)}`);
       let selected_ = String.fromCharCode(116,101,109,112,111,114,97,114,121,95,99,95,51,51,0);
         selected_ = `${(selected_ == String.fromCharCode(84,0) ? selected_.length : selected_.length)}`;
      if (selected_.length >= selected_.length) {
          let wifirouterv = String.fromCharCode(108,105,103,104,116,101,110,105,110,103,95,110,95,52,50,0);
          let overlayY = String.fromCharCode(97,118,102,102,116,95,107,95,56,53,0);
          let countdownv = String.fromCharCode(116,97,107,101,111,118,101,114,95,121,95,50,56,0);
         selected_ += "2";
         wifirouterv = `${countdownv.length}`;
         overlayY += `${wifirouterv.length}`;
         countdownv = `${countdownv.length & 2}`;
      }
      for (let f = 0; f < 2; f++) {
          let quest5 = String.fromCharCode(115,115,116,104,114,101,115,104,95,51,95,53,52,0);
          let r_managerv = 2.0;
         selected_ = `${(String.fromCharCode(51,0) == selected_ ? quest5.length : selected_.length)}`;
         quest5 = `${parseInt(`${r_managerv}`)}`;
      }
      combinedS /= Math.max(parseFloat(`${smallt.length}`), 4);
      reactnativejsb /= Math.max(smallt.length % 1, 4);
   for (let i = 0; i < 1; i++) {
       let championr = 5;
       let linkh = true;
       let volume5 = String.fromCharCode(100,99,97,100,97,116,97,95,50,95,53,0);
       let register_l6Q = String.fromCharCode(115,104,97,114,101,115,95,108,95,57,48,0);
       let dycreatorh = String.fromCharCode(111,112,116,105,109,105,115,116,105,99,95,106,95,49,51,0);
      while (register_l6Q != volume5) {
         volume5 = `${((linkh ? 4 : 5) << (Math.min(Math.abs(2), 3)))}`;
         break;
      }
       let switch_bM: Map<any, any> = new Map([[String.fromCharCode(101,120,97,99,116,95,48,95,54,0),false ], [String.fromCharCode(103,95,54,48,95,115,105,122,101,98,105,116,114,97,116,101,0),true ]]);
       let whistleorangen: Map<any, any> = new Map([[String.fromCharCode(108,95,57,50,0),String.fromCharCode(102,97,108,108,111,102,102,95,120,95,55,50,0)], [String.fromCharCode(115,95,49,49,95,115,116,114,108,99,97,116,0),String.fromCharCode(107,101,101,112,95,115,95,57,57,0)]]);
      let assistY = 8147243 <= championr;
      do {
         championr &= 1;
         if (assistY) {
            break;
         }
      } while ((whistleorangen.get(`${championr}`) == null) && assistY);
       let humidityd = 2.0;
          let imageactionliveS = String.fromCharCode(117,95,57,54,95,101,120,112,97,110,100,101,114,0);
          let matchesZ: Array<any> = [207, 648];
          let logoA = 3;
         dycreatorh = `${2 ^ whistleorangen.size}`;
         imageactionliveS = `${imageactionliveS.length}`;
         matchesZ = [matchesZ.length];
         logoA |= imageactionliveS.length;
      for (let h = 0; h < 3; h++) {
          let refreshborderlessn = String.fromCharCode(122,95,50,48,95,100,105,102,102,101,114,101,110,99,101,0);
          let iconeyeq: Array<any> = [567, 818];
          let reactnativejs1 = String.fromCharCode(104,95,52,53,95,101,108,115,0);
         switch_bM.set(`${dycreatorh}`, whistleorangen.size);
         refreshborderlessn = `${reactnativejs1.length * iconeyeq.length}`;
         iconeyeq.push(refreshborderlessn.length);
         reactnativejs1 += `${refreshborderlessn.length << (Math.min(Math.abs(2), 3))}`;
      }
      while (dycreatorh.startsWith(`${switch_bM.size}`)) {
          let playercommonI = true;
          let statisticsinactiveJ = String.fromCharCode(119,95,50,48,95,103,101,111,108,111,99,97,116,105,111,110,0);
          let bell4 = 2;
         switch_bM.set(`${linkh}`, volume5.length);
         playercommonI = statisticsinactiveJ.startsWith(`${bell4}`);
         statisticsinactiveJ = `${(String.fromCharCode(112,0) == statisticsinactiveJ ? bell4 : statisticsinactiveJ.length)}`;
         break;
      }
      for (let y = 0; y < 3; y++) {
         switch_bM.set(`${championr}`, 1);
      }
          let homeplayerU = String.fromCharCode(110,95,49,56,95,115,116,97,114,116,0);
          let mbnativeB = String.fromCharCode(121,95,54,48,95,98,105,110,100,101,114,0);
          let areaH = String.fromCharCode(116,95,49,48,95,115,116,97,98,105,108,105,122,97,116,105,111,110,0);
         whistleorangen = new Map([[volume5, register_l6Q.length]]);
         homeplayerU = `${homeplayerU.length * areaH.length}`;
         mbnativeB = `${(String.fromCharCode(120,0) == areaH ? areaH.length : mbnativeB.length)}`;
      if (2 == (dycreatorh.length & 3) && 3 == (dycreatorh.length & switch_bM.size)) {
         switch_bM.set(volume5, (String.fromCharCode(121,0) == volume5 ? volume5.length : parseInt(`${humidityd}`)));
      }
       let topicK = 1.0;
      if (4 <= (3 + whistleorangen.size) && (humidityd * 2.29) <= 2.97) {
         humidityd -= parseFloat(`${volume5.length}`);
      }
      while (!linkh || 2 == volume5.length) {
         volume5 += `${parseInt(`${humidityd}`) + 3}`;
         break;
      }
         topicK -= dycreatorh.length & 1;
          let nendj: Array<any> = [735, 506];
          let stationsq: Map<any, any> = new Map([[String.fromCharCode(98,95,49,51,95,99,104,97,114,99,111,110,118,0),false ], [String.fromCharCode(112,95,57,56,95,112,114,111,100,117,99,101,114,0),false ]]);
          let logind: Map<any, any> = new Map([[String.fromCharCode(115,101,99,111,110,100,95,111,95,53,53,0),104], [String.fromCharCode(115,105,103,112,97,115,115,95,50,95,57,48,0),501], [String.fromCharCode(99,100,102,116,95,49,95,54,57,0),162]]);
         linkh = dycreatorh.length == nendj.length;
         nendj = [logind.size | 3];
         stationsq = new Map([[`${stationsq.size}`, stationsq.size]]);
         logind.set(`${stationsq.size}`, stationsq.size - 1);
      defaultlogok *= parseFloat(`${reactnativejsb % 2}`);
   }

    planRef?.current?.scrollToIndex({
      index: membershipProduct.length - 1,
      animated: true,
      viewPosition: 0.5,
    });
  };

  useEffect(() => {
    if (isRefreshing == false) {
      console.log(false)
      setTimeout(() => { setListPosition() }, 200);
    }
  }, [isRefreshing]);

  return (
    <View
      style={{
        flexDirection: 'column',
      }}>

      { }
      <FlatList
        ref={planRef}
        horizontal={true}
        
        getItemLayout={getItemLayout}
        onScrollToIndexFailed={() => { }}
        contentContainerStyle={styles.membershipContainer}
        showsHorizontalScrollIndicator={false}
        data={membershipProduct}
        keyExtractor={(product) => product.productId}
        renderItem={({ item, index }) => (
          <VipMember
            key={index}
            membershipPlan={item}
            isSelected={selectedMembership && selectedMembership.productId === item.productId}
            onSelect={onMembershipSelect} />
        )}
      />

      { }
      {(UMENG_CHANNEL !== "GOOGLE_PLAY" || IS_IOS) && zfOptions.length > 0 &&
        <View
          style={{
            marginBottom: 15,
            gap: 15,
          }}>
          <Text
            style={styles.label}>
            支付方式
          </Text>
          <View style={{ gap: 10 }}>
            {zfOptions.map((option) => (
              <VipZf
                key={option.payment_type_code}
                zfOption={option}
                isSelected={selectedZf === option.payment_type_code}
                onZfSelect={onZfSelect} />
            ))}
          </View>
        </View>
      }
    </View>
  );
}

const styles = StyleSheet.create({
  label: {
    fontFamily: "PingFang SC",
    fontSize: 18,
    fontWeight: "900",
    color: "#D3AC7B",
  },
  membershipContainer: {
    gap: 15,
    marginBottom: 15,
    flexDirection: 'row',
  }
})
