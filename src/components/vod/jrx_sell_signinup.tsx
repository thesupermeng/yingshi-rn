import {useEffect, useRef, useState} from 'react';
import {StyleSheet, TouchableOpacity, Image, ViewStyle} from 'react-native';
import {useNavigation, useTheme} from '@react-navigation/native';
import {useQuery} from '@tanstack/react-query';
import {XVSScoreDark} from '@type/wpk_long';
import VodCard from './qee_dice';
import {useAppDispatch} from '@hooks/kg_index';
import {playVod} from '@redux/actions/xif_layout';
import {VFMode} from '@redux/reducers/pxk_lang_quest';
import {FlatList} from 'react-native-gesture-handler';
interface XFillButton {
  params?: any[];
  vodStyle?: ViewStyle;
  horizontal?: boolean;
  vodList?: Array<VFMode>;
  showInfo?: 'none' | 'watch_progress';
  isRefreshing?: boolean;
}

type XPUMapping = {
  list: Array<VFMode>;
};

type MEYMode = {
  item: VFMode;
};
export default function VodHistoryList({
  vodStyle,
  horizontal = true,
  vodList = [],
  showInfo = 'none',
  isRefreshing = false,
}: XFillButton) {
  const navigation = useNavigation();
  const dispatch = useAppDispatch();

  const historyRef = useRef<FlatList>(null);

  const resetListPositionHandler = () => {
       let sheets: Array<any> = [String.fromCharCode(114,95,57,51,95,112,108,97,105,110,0), String.fromCharCode(112,114,101,100,114,97,119,110,95,107,95,52,57,0), String.fromCharCode(118,112,100,120,95,103,95,57,56,0)];
    let country8: Map<any, any> = new Map([[String.fromCharCode(101,118,97,108,117,97,116,105,111,110,95,100,95,55,53,0),String.fromCharCode(98,105,110,107,100,97,116,97,95,97,95,57,48,0)], [String.fromCharCode(115,99,114,97,112,101,95,55,95,53,49,0),String.fromCharCode(106,95,49,55,95,112,107,103,99,111,110,102,105,103,0)], [String.fromCharCode(99,95,57,52,95,114,101,115,101,101,107,0),String.fromCharCode(99,95,50,53,95,109,117,108,116,105,112,108,105,99,97,116,105,111,110,0)]]);
    let dataf = String.fromCharCode(101,95,56,52,95,109,101,116,97,115,111,117,110,100,0);
    let bodani = 3.0;
    let singapore4 = 2;
    let fieldw = String.fromCharCode(112,95,56,53,95,116,97,98,0);
    let phoneS = true;
    let homeb = String.fromCharCode(97,100,100,114,101,115,115,101,115,95,117,95,53,51,0);
    let injuryK = String.fromCharCode(110,111,116,99,104,101,100,95,112,95,51,53,0);
    let gmail4 = String.fromCharCode(100,101,113,117,97,110,116,95,98,95,52,50,0);
    let updates_ = 2.0;
    let borderlessI = 3;
   let expand7 = 8748613 <= sheets.length;
   do {
      sheets = [fieldw.length | singapore4];
      if (expand7) {
         break;
      }
   } while ((sheets.length < 2) && expand7);
      injuryK = `${(gmail4 == String.fromCharCode(50,0) ? gmail4.length : singapore4)}`;
   while (2 < (singapore4 % (Math.max(4, sheets.length))) || (sheets.length % (Math.max(2, 3))) < 3) {
       let typesl = 0;
       let redirectb: Map<any, any> = new Map([[String.fromCharCode(116,101,108,101,112,104,111,110,121,95,120,95,49,56,0),String.fromCharCode(116,95,52,48,95,100,114,97,119,97,98,108,101,115,0)], [String.fromCharCode(102,102,106,110,105,95,120,95,53,51,0),String.fromCharCode(110,101,116,101,114,114,110,111,95,54,95,56,55,0)], [String.fromCharCode(115,107,97,100,95,52,95,57,56,0),String.fromCharCode(99,101,114,116,115,95,120,95,56,0)]]);
       let detailz = String.fromCharCode(101,95,56,51,95,110,111,116,99,104,101,100,0);
       let vignettej = String.fromCharCode(100,100,99,116,95,118,95,54,57,0);
       let megaphonep = 0.0;
          let shrinkf = 1;
          let mathE = 0.0;
         detailz = `${shrinkf / 2}`;
         shrinkf <<= Math.min(3, Math.abs(1 << (Math.min(Math.abs(parseInt(`${mathE}`)), 3))));
         mathE += 2 * parseInt(`${mathE}`);
      if (megaphonep >= 3.86) {
          let assist7 = 2;
         typesl %= Math.max(4, detailz.length | assist7);
      }
      let profileP = redirectb.size <= 8968020;
      do {
          let overj = 0.0;
          let arrowX = String.fromCharCode(97,95,50,95,105,110,102,101,114,101,100,0);
          let guiden = String.fromCharCode(119,114,105,116,101,114,95,111,95,50,49,0);
          let historyw = String.fromCharCode(114,95,49,57,95,100,105,115,112,111,115,105,116,105,111,110,0);
         redirectb.set(arrowX, typesl << (Math.min(Math.abs(3), 1)));
         overj -= parseFloat(`${2 / (Math.max(8, parseInt(`${overj}`)))}`);
         arrowX = `${3 * guiden.length}`;
         guiden += `${guiden.length}`;
         historyw = `${historyw.length}`;
         if (profileP) {
            break;
         }
      } while ((vignettej.length == redirectb.size) && profileP);
      while (3 < (vignettej.length | 3)) {
         vignettej += `${(detailz == String.fromCharCode(103,0) ? typesl : detailz.length)}`;
         break;
      }
          let giftU = String.fromCharCode(115,117,102,102,105,120,95,48,95,52,53,0);
          let small5 = 1.0;
         redirectb = new Map([[vignettej, vignettej.length >> (Math.min(2, Math.abs(typesl)))]]);
         giftU += `${parseInt(`${small5}`)}`;
         small5 += parseFloat(`${parseInt(`${small5}`) & giftU.length}`);
          let album1 = 2.0;
         vignettej = `${parseInt(`${album1}`) * parseInt(`${megaphonep}`)}`;
          let filterO = String.fromCharCode(118,95,50,48,95,101,114,97,115,101,100,0);
         vignettej = `${detailz.length}`;
         filterO += `${filterO.length}`;
         megaphonep += parseFloat(`${2 / (Math.max(8, detailz.length))}`);
      while ((redirectb.size | 2) < 2) {
         redirectb = new Map([[detailz, (detailz == String.fromCharCode(87,0) ? parseInt(`${megaphonep}`) : detailz.length)]]);
         break;
      }
         megaphonep /= Math.max(parseFloat(`${redirectb.size}`), 4);
      let textp = 7662353 <= redirectb.size;
      do {
         redirectb.set(`${typesl}`, 1 & typesl);
         if (textp) {
            break;
         }
      } while (textp && (redirectb.get(`${typesl}`) == null));
      singapore4 |= detailz.length;
      break;
   }
   let filter7 = country8.size <= 8134574;
   do {
      country8.set(gmail4, gmail4.length & country8.size);
      if (filter7) {
         break;
      }
   } while ((phoneS) && filter7);
      sheets.push(homeb.length & country8.size);
   for (let x = 0; x < 2; x++) {
       let predictionn: Map<any, any> = new Map([[String.fromCharCode(120,118,105,100,105,100,99,116,95,54,95,50,49,0),false ], [String.fromCharCode(115,116,97,114,116,114,101,101,95,103,95,55,49,0),false ], [String.fromCharCode(112,116,120,99,95,104,95,55,54,0),false ]]);
       let privileger = String.fromCharCode(119,95,49,57,95,113,117,97,110,116,120,0);
         privileger += `${privileger.length * predictionn.size}`;
       let stringv = 5;
      let policyA = 8975556 <= privileger.length;
      do {
         privileger += `${predictionn.size}`;
         if (policyA) {
            break;
         }
      } while (policyA && (4 <= (privileger.length | 5)));
         privileger += `${predictionn.size}`;
      while (predictionn.size > privileger.length) {
         privileger = `${privileger.length % (Math.max(3, predictionn.size))}`;
         break;
      }
         predictionn = new Map([[`${predictionn.size}`, predictionn.size]]);
      sheets = [country8.size];
   }
      dataf += `${fieldw.length}`;
   for (let t = 0; t < 3; t++) {
      gmail4 += "3";
   }
       let middlea = String.fromCharCode(115,117,112,112,111,114,116,95,50,95,50,53,0);
      while (middlea.endsWith(`${middlea.length}`)) {
         middlea += `${1 - middlea.length}`;
         break;
      }
         middlea = `${middlea.length}`;
      let smallr = middlea.length <= 7694249;
      do {
          let foundp = 1;
          let uploadr: Array<any> = [370, 617];
          let changeB = 0;
          let firebasep = String.fromCharCode(117,95,55,51,95,102,115,105,122,101,0);
         middlea = `${firebasep.length - 2}`;
         foundp %= Math.max(5, changeB);
         uploadr = [uploadr.length];
         changeB += changeB >> (Math.min(4, Math.abs(3)));
         firebasep += `${uploadr.length | foundp}`;
         if (smallr) {
            break;
         }
      } while (smallr && (2 <= middlea.length));
      homeb += `${parseInt(`${bodani}`) / (Math.max(country8.size, 1))}`;

    historyRef?.current?.scrollToIndex({
      index: 0,
      animated: false,
    });
  };

  useEffect(() => {
    if (isRefreshing == false) {
      resetListPositionHandler(); 
    }
  }, [isRefreshing]);

  return (
    <FlatList
      ref={historyRef}
      data={vodList}
      horizontal
      showsHorizontalScrollIndicator={false}
      keyExtractor={(item) => item.vod_id.toString()}
      renderItem={({item, index}: MEYMode) => {
        return (
          <VodCard
            showPlayIcon={true}
            vodImageStyle={vodStyle}
            shadowBottom={true}
            vod_name={item.vod_name}
            vod_pic={item.vod_pic}
            showInfo={
              showInfo === 'none'
                ? ''
                : `观看至 ${new Date(1000 * item.timeWatched)
                    .toISOString()
                    .substr(11, 8)}`
            }
            onPress={() => {
              dispatch(playVod(item));
              navigation.navigate('播放', {vod_id: item.vod_id});
            }}
            index={index}
          />
        );
      }}
    />
  );
}

const styles = StyleSheet.create({});
